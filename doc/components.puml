@startuml

[JS-Client] #Green

node UserSvc #red
node AuthSvc #red

node "webmodelica-ui" {
  [Static File Server] #Green
  [JS-Client] --> [Static File Server]
}

node "webmodelica" {
  () "HTTP-API" as wm_http
  [JS-Client] --> wm_http
  [JS-Client] --> AuthSvc
  [ProjectService] #Grey
  [UserService] --> UserSvc
  [DocumentDBStore] #Grey
  wm_http - [Routes] : "api calls"

  [Routes] --> [SessionService]
  [Routes] --> [SessionRegistry]
  [Routes] --> [ProjectService]
  [Routes] --> [UserService]
  [Routes] --> [(JW-)Token Generator]

  [ProjectService] --> [ProjectDBStore]
  [UserService] --> [UserDBStore]

  [SessionRegistry] --> [SessionService]

  [SessionService] --> [DocumentFSStore]
  [SessionService] --> [DocumentDBStore]
  [SessionService] --> [MopeClient]
}

node "mope" {
  () "HTTP" as mope_http
  [MopeClient] --> mope_http
  mope_http - [Endpoint]
}

storage RedisCache

database MongoDB {
  storage User
  storage Project
  storage ModelicaFile as doc_file
}

database "filesystem" {
  rectangle ModelicaFile as fs_file
}
note left of fs_file : the directory that mope "sees"

[ProjectDBStore] --> Project
[UserDBStore] --> User
[UserService] --> RedisCache : cache users
[SessionService] --> RedisCache : cache completions
[DocumentDBStore] --> doc_file
[DocumentFSStore] --> fs_file : write project files

[Endpoint] <-- fs_file : read project files
@enduml
